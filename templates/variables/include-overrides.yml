parameters:
  - name: baseDeploymentVersion
    type: string
    default: ""
  - name: suffixToken
    type: string
    default: ""
  - name: variableOverrides
    type: object
    default: {}

variables:
  # Persist the base deployment version for later formatting
  - name: baseDeploymentVersion
    value: ${{ parameters.baseDeploymentVersion }}

  # Action-group supplied suffix token (ensures uniqueness across parallel jobs)
  - name: overrideSuffixToken
    value: ${{ parameters.suffixToken }}

  # Optional override variables provided by the caller
  - ${{ each variable in parameters.variableOverrides }}:
      - name: ${{ variable.key }}
        value: ${{ format('{0}', variable.value) }}

  # Dynamic suffix support (opt-in per action group)
  - name: runSuffix
    value: $[ format('{0}_{1}', variables['Build.BuildId'], coalesce(variables['overrideSuffixToken'], 'action')) ]
  - name: deploymentVersion
    value: $[ iif(eq(lower(coalesce(variables['dynamicDeploymentVersionEnabled'], 'false')), 'true'), format('{0}_{1}', variables['baseDeploymentVersion'], variables['runSuffix']), variables['baseDeploymentVersion']) ]
