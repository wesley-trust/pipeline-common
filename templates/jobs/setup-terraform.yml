# Setup: Terraform installation

parameters:
  - name: name
    type: string
    default: setup_terraform
  - name: displayName
    type: string
    default: Setup: Terraform
  - name: terraformVersion
    type: string
    default: ''
  - name: pool
    type: object
    default: {}

job: ${{ parameters.name }}
displayName: ${{ parameters.displayName }}
condition: and(succeeded(), ne('${{ parameters.terraformVersion }}',''))
pool:
  ${{ if ne(coalesce(parameters.pool.name, ''), '') }}:
    name: ${{ parameters.pool.name }}
  ${{ if and(eq(coalesce(parameters.pool.name, ''), ''), ne(coalesce(parameters.pool.vmImage, ''), '')) }}:
    vmImage: ${{ parameters.pool.vmImage }}

steps:
  - checkout: PipelineCommon

  - template: steps/azurecli.yml@PipelineCommon
    parameters:
      displayName: Install Terraform ${{ parameters.terraformVersion }}
      repoAlias: PipelineCommon
      script: setup_terraform.ps1
      arguments: -Version ${{ parameters.terraformVersion }}
